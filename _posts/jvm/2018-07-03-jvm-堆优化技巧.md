---
layout: post
title:  "JVM 堆优化技巧"
date:   2018-07-03 13:31:01 +0800
categories: jvm
tag: [jvm]
---

* content
{:toc}


# 概述    

堆优化是JVM的主要方向,绝大部分的JVM优化都是围绕着GC围绕着堆来的.  
堆优化的前置是对于GC机制的认知  
堆的上限空间不是越大越好,更大的堆空间虽然能避免一部分的OOM,减少GC的次数.但会大堆会扫描更多的对象从而停止更多时间.大部分的情况下,STW的时间过长都是不可接受的,并且常常会产生一些莫名其妙的问题.比如与一些中间件的会话超时  

# 应用程序分析  

堆优化一定是从应用程序本身着手的,不同的应用程序中不同业务逻辑,场景乃至所在机器的配置等等,都可能会产生影响,这就是说,每个应用程序的最终优化都有不同,大致来说可以从以下思路思考  

* 32位机,堆上限通常不会超过2G.而64位机一般是4G起步,并且通常不应该超过32G  
* 应用程序中的运行时加载情况(包括第三方)  
如果有大量的运行时加载情况(比如Web热部署),就需要适当的考虑方法区大小(HP的永生代或者元空间),因为类信息最终是占据方法区的,方法区也需要考虑GC和OOM  
* 应用程序的对象使用情况   
如果有大量的缓存应用,就需要适当的提高老年代的大小.因为缓存属于典型的长生对象,大部分都最终落入和占据老年代,会极大的挤压老年代本身的空间而被迫触发FullGC.如果有大量的瞬时对象也应该适当提高年轻代,避免频繁的MinorGC导致将一些瞬时对象错误提升到老年代而挤压老年代空间    
* 应用程序的线程数量  

总之,对应用程序进行深入了解.包括所在机器,类型信息,瞬时对象以及长生对象的比率以及可能的大小,以及可能的峰值预估等等  

# 运行时追踪  

堆优化中,追踪是非常必要的环节.因为预估,往往受经验所限,甚至是信息有误而导致误判.所以持续的在运行时追踪,是非常有必要的  

## GC日志打印  

## 分析器工具  


