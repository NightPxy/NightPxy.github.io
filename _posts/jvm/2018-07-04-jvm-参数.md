---
layout: post
title:  "JVM-1.8-Hotspot 参数"
date:   2018-07-04 13:31:01 +0800
categories: jvm
tag: [jvm]
---

* content
{:toc}


# 概述    

JVM 的参数共分三种  
* -参数 标准参数  
这是JVM规范中定义的参数,会强制要求每个JVM实现都必须实现并保持兼容  
最常见的标准参数就是 `java -version`  
常用的还有verbos命令 `-verbose:class` 打印载入类相关信息,在JVM报告找不到类或类冲突时非常有用  
* -X参数 非标准参数  
也是JVM规范中定义,但不强制要求必须实现  
最常见的非标准参数 `-Xmx100m(堆最大) -Xms100m(堆初始) -Xmn100(年轻代)`  
* -xx参数 不稳定参数  
这就是纯粹由每个JVM实现的自定义参数了  
以Hotspot为例, `-XX:+PrintGCDetails(打印GC日志)`  

关于参数赋值  

* bool型  +打开 -关闭  
`-XX:+PrintGCDetails(打开) -XX:-PrintGCDetails(关闭)`  
* 数字型 直接设  
`-Xmx100m`  
* 字符串 =  
`-XX:HeapDumpPath=./java_pid.hprof`  

# 非标准参数  

|参数|描述|
|---|---|
|-Xmx100m|堆最大上限|
|-Xms100m|堆初始大小,一般设置与最大相同,避免GC回收后JVM重新分配内存来伸缩堆|
|-Xmn200m|年轻代大小(Eden+2个Survivor共计),官方推荐3/8,老年代自动=堆-年轻代|
|-Xss128k|线程栈大小,1.5后默认1M.更少的线程栈可以产生更多线程(但受操作系统上限)|
|-Xloggc:file|将每个状态记录如文件中(带时间戳)|
|-Xdebug||

# 不稳定参数   

|参数|描述|
|---|---|
|-XX:SurvivorRatio|用于设置Eden和两个Survivor的比值,默认为8(Eden):1:1(1/10)|
|-XX:MaxMetaspaceSize=10M|设置元空间最大为10M,默认无限制|
|-XX:-UseParallelGC|启用并行GC|
|-XX:-UseSerialGC|启用串行GC|
|-XX:-UseConcMarkSweepGC|对老年代采用并发标记交换算法进行GC|
|-XX:-DisableExplicitGC|禁止代码调用System.gc,JVM的GC依然有效|
|-XX:MaxNewSize=N|新生代对象能占用内存的最大值|
|-XX:MaxPermSize=64M|老年代对象能占用内存的最大值|
|-XX:NewSize=2.125m|新生代对象生产时占用内存的默认值|
|-XX:ThreadStackSize=512|设置线程栈大小,为0表示使用系统默认值|
|-XX:HeapDumpPath=./java_pid<pid>.hprof|指定导出堆信息时的路径或文件名|
|-XX:-HeapDumpOnOutOfMemoryError|当首次遭遇OOM时导出此时堆中相关信息|

SurvivorRadio  
-XX:SurvivorRadio=4,表示Eden区与Survivor区的比值为4,但因为Survivor实际有两个,所以其具体比例为4:1:1,即Eden占4/6,每一个Survivor占1/6  

GC执行三种方式,串行(Serial),并行(Parallel),并发(ConcMarkSweep)  
* 串行是client版的默认,GC与App互斥,即整个GC都会停顿  
* 并行是Server版的默认,GC与App两者线程并行执行,但此时GC线程本身是单线程  
* 并发是并行的升级版,GC本身就以多线程执行  



# 调优经验  



# 分享网上一个牛人的参数调优  

该牛人主要使用的CMS,Web项目每天几百万PV感觉不到任何停顿,值得借鉴和参考  

```shell
-Dresin.home=$SERVER_ROOT
-server
-Xms6000M  
-Xmx6000M #堆初始和最大都设置6G,这样可以避免GC之后内存释放导致JVM重新伸缩堆
-Xmn500M #年轻代设置相对偏小,用大量微MinorGC来换取停顿时间变短
-XX:PermSize=500M  
-XX:MaxPermSize=500M # 永生代初始和默认都500M,也可以减少堆伸缩
-XX:SurvivorRatio=65536
-XX:MaxTenuringThreshold=0
-Xnoclassgc
-XX:+DisableExplicitGC
-XX:+UseParNewGC
-XX:+UseConcMarkSweepGC
-XX:+UseCMSCompactAtFullCollection
-XX:CMSFullGCsBeforeCompaction=0
-XX:+CMSClassUnloadingEnabled
-XX:-CMSParallelRemarkEnabled
-XX:CMSInitiatingOccupancyFraction=90
-XX:SoftRefLRUPolicyMSPerMB=0
-XX:+PrintClassHistogram
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintHeapAtGC
-Xloggc:log/gc.log
```

